[TOC]



# 测评对比

## 存储需求

1、常用小文件 icloud
2、常用小文件备份 坚果云
3、少用大文件 百度云
4、少用大文件备份 移动硬盘
5、临时大文件共享 kodexplorer
6、mac 系统 时间机器

## 功能需求：

同步，最好是增量同步，否则修改几个文档也要重新上传全部文件很蛋疼

预览 md、xls、mp4 文件

搜索

分享

上传文件夹

历史记录

## ==综合方案==

1）icloud + seafile + 移动硬盘 + kodexplorer + syncthing 备份 seafile

缺点：seafile 上传下载速度不稳定，用 virmach 最差的时候下载 5 k/秒；

2）icloud + nextcloud + 移动硬盘 + kodexplorer + syncthing 备份 nextfile

缺点：nextcloud 不是增量同步；nextcloud 数据安全性弱；

3）icloud + 坚果云 + 移动硬盘 + kodexplorer

缺点：坚果云免费版不能搜索；流量只有 1G/月；

## Dockerhub 私有网盘 Star 数量

seafile 35

kodexplorer 8

ownfile 0

nextcloud 686

h5ai 27

filebrowser 9

syncthing 117

synctrayzor none

## 同步测试

『syncthing』不能同步 icloud 文件夹

『坚果云』『seafile』可以同步 icloud 文件夹

## Vps 购买

Letbox，内存 2G，200 G，25 $/年，续费类似的价格（很多大盘鸡特价便宜但是续费很贵）



# 文件存储/共享的方式

## 一、公有云

### 1】微云

缺点：同步功能简陋；没有版本控制；界面典型的乞丐版；百度和腾讯一样，各种产品分开收费，价格不低；

优点：便宜空间大，120 元/3T/年；

### 2】坚果云

优点：增量备份（主推功能），可以为某个文件夹增加或取消同步；版本控制；

适用：备份聊天记录，写作草稿，设计草稿，读书笔记

缺点：**免费版不能搜索**；容量小，免费用户 1G/月（容量上限不受限），标准 199 元/30G/年（容量上限相比免费的反而受限了。。）；如果一次性要上传或下载大文件会被中断；

联通上传 200k/s，下载 300 k/s；电信上传 200 k/s，下载 5 M/s 或 30-150 k/s；

### 3】亿方云

缺点：没有增量备份；

优点：版本控制；免费空间大 20 G；免费版 5 人协作办公；

适用：可以存文本笔记和办公文件；

### 4】阿里酷盘

缺点：财迷心窍，建议弃用；

### 5】百度云

优点：免费空间大 2T；

缺点：上传文件、或同步文件后本地文件夹时间会被修改（因为会建立临时文件）；

### 6】Onenote、Onedriver

优点：400 元/1T/年购买 365 后赠送；上传不限速；版本控制；

缺点：没有增量备份；

适用：愿意付费建议使用，没有什么硬伤；

## 7】icloud

优点：增量同步；本地挂载，随时随地全盘备份；

最大缺点：安卓不能访问，只能浏览器开启桌面版，开启后只能下载不能预览文件

## #=> 总结

1）如果资料不多，对版本控制有一点要求，建议用『亿方云』

2）如果不抠门，用『坚果云』或『Onedriver』。笔记类应用『印象笔记高级版（并不推荐因为太贵）』，或『为知笔记（另一个便宜的选择）』，或『有道云笔记（付费容量才 50G）』。

> 注意：笔记软件相比同步盘，最不好的地方在于不能上传文件夹，而且最好要付费，否则笔记在别人手上后，批量下载、备份、分享、版本控制、限速等等功能都会受限

3） 不推荐用 『Dropbox』或『google driver』，哪天梯子被拆了就抓急了

4）保存福利的推荐用『百度云』或『微云』，微云性价比更高 120 元/3T/年

5）平时用『坚果云』增量同步，定期用『移动硬盘』或『亿方云』『google driver』等定期备份，或用『syncthing』同步



## 二、私有云

[VPS搭个人网盘，seafile、kodexplorer、h5ai谁更合适？](http://www.vpsjxw.com/vps_use/seafile_kodexplorer_h5ai_compare/)

总的来说，工作场合更适合用 Seafile，个人使用我比较推崇 Nextcloud/Owncloud，https://www.v2ex.com/t/370780

### 1】可道云 kodexplorer（宝塔面板）

支持 office 预览但不能编辑；无数据库安装方便；

没有安卓客户端

速度：电信上传 70-200 k/s，下载 1-2 M/s；联通上传 3M/s，下载 2 M/s；

```
# ubuntu 安装宝塔面板(最好在纯净的vps上或在开启防火墙等配置前安装，否则容易出错)
wget -O install.sh http://download.bt.cn/install/install-ubuntu.sh && sudo bash install.sh

# 宝塔面板端口：80/888/8888/20/21/443

# 卸载宝塔面板
先在面板上卸载 LNMP 环境
rm -f /etc/init.d/bt && rm -rf /www/server/panel
```

```
# Docker方式安装
docker run -d -p 80:80 --name kodexplorer --restart=always -v /opt/kodexplorer:/var/www/html yangxuan8282/kodexplorer
```

### 2】seafile（基于 C）

> 推荐用 docker 安装，10 分钟搞定 http://www.vpsjxw.com/vps_use/seafile_intro/
>
> 『初行博客』个人建设网盘的最佳选择之一

跨多平台；中文文档齐全；增量同步；专业版 3 个用户以下免费（个人使用推荐）；历史记录

缺点：由于数据分块存储，备份时要把整个 seafile 备份下来；不能预览 office 文件；



安装/卸载 docker 官方教程：https://docs.docker.com/install/linux/docker-ce/ubuntu/#os-requirements

```
Package docker.io is not available, but is referred to by another package
编辑 /etc/opt/sources.list ，添加 deb http://ftp.debian.org/debian jessie-backports main

私有仓库账号：docker login docker.seadrive.org，账号 seafile，密码 zjkmid6rQibdZ=uJMuWS

apt-get install zip
tar -zcvf workspace.tar.gz worksapce
tar -xvf seafile.tar.gz 

# 修改 SEAFILE_SERVER_LETSENCRYPT（先用 false 测试，因为每周只能申请 5 份证书）、密码、端口、先用 --rm 测试，最后换 --restart=always 
docker run -d --name seafile --restart=always \
  -e SEAFILE_SERVER_LETSENCRYPT=true \
  -e SEAFILE_SERVER_HOSTNAME=xiaochu.gq \
  -e SEAFILE_ADMIN_EMAIL=admin \
  -e SEAFILE_ADMIN_PASSWORD=Admin@111 \
  -v /www/seafile:/shared \
  -p 80:80 \
  -p 443:443 \
  docker.seadrive.org/seafileltd/seafile-pro:latest
 
 注意：
 1、实测发现，配置 https 证书时只能用 80、443 端口（用其他端口页面打不开）
 2、容器开启后，要进入网页-系统管理-设置-把 URL 根据情况改成 http 或 https
 3、客户端-设置-高级-勾选 “不自动解除同步”、“当服务器..不要自动解除”、“HTTPS同步..”

# 开机自启动，https://blog.csdn.net/julius819/article/details/7665679
systemctl enable docker
systemctl list-unit-files |grep docker

# 容器开机启动参数
--restart=on-failure:10
--restart=always

访问：http://域名:端口

# 20181206
第一次开启建议用 `SEAFILE_SERVER_LETSENCRYPT=false` 参数，因为 LETSENCRYPT 证书每个域名每周只能申请 5 份。容器开启成功，seafile 也成功运行后，再删除容器，用 `SEAFILE_SERVER_LETSENCRYPT=true` 参数重开一个。

# 同步错误重启 docker
systemctl restart docker.service
```

### 测试出的硬伤：

virmach 2G

二十三点，下载 5 k/s

四点，上传 50 k/s（上传 10M/20M/30M 文件均网络错误），同步 120 k/s

十三点，上传 100-200 k/s（上传 10M/20M/30M 文件均网络错误），同步 100-200 k/s；

十六点，上传 150-200 k/s，下载 0.2-1 M/s；联通上传 2.5-3.5 M/s，下载 30-120 k/s；

google cloud

十六点，上传 120-220 k/s（上传 10M/20M/30M 文件均网络错误），下载 1 M/s 或 0.2 M/s；联通上传 2.5-4.5 M/s，下载 2M/秒

> 跟服务器所对应的宽带线路速度相关

### 备份方法：

1）备份文件夹 /opt/seafile-data

### 恢复方法：

1）恢复文件夹 /opt/seafile-data

2）开启 docker 容器

3）开启隐身窗口（确保浏览器不会重定向到 https），访问 http 域名并登陆，修改配置：系统管理 - 设置 - URL 里把 `SERVICE_URL` 和 `FILE_SERVER_ROOT` 的 `http` 前缀改为 `https`。比如 `https://example.com`、`http://example.com/seafhttp`

> 注意1：如果使用 ssl，必须修改配置 URL 为 https，否则会出现手机端和网页端数据无法预览、无法上传、无法下载、共享链接无效等等一系列无法正常使用的问题。
>
> 注意2：如果修改了挂载的端口，要用 `http://域名:端口` 访问

### ~~3】owncloud（基于 php）~~

跨多平台；相比 seafile，不稳定、速度慢、文档全英文，企业版只能试用 30 天

缺点：没有历史记录；逗比测试说环境问题引发的未知 bug 很多；

### 4】nextcloud（基于 php）

> 集成owncloud的底子所以nextcloud 非常成熟可靠。虽然偏向臃肿，但是nextcloud 更加成熟，插件的支持、多用户等等都对需求比较多的人来说非常棒。如果你需要一款功能强大的网盘程序，那么成熟的nextcloud将会是首选。

> 看起来高大上，但实际用起来问题多，LNMP虽然支持，但特性少，很多功能不支持，装上之后功能缺失。然后在设置里面，nextcloud报了一堆警告，根本还是LNMP默认环境问题。所以要自己根据软件的要求去配置NGINX环境。然后就是存储路径不可自定义，自定义就报错。客户端不支持文件浏览，只能在网页上看。

跨多平台；企业版可以被普通用户使用，

可以挂载谷歌云无限量盘，用于云播放

vultr 服务器

十八点，联通上传下载 2M/s；电信上传 20k/s，下载 80k/s；

测试发现：电信上传下载速度特慢；上传中的文件无法取消上传；

## #=> 总结

https://www.dukeyin.com/2018/03/cloud-storage/

> Yin Duke：「虽然私有云满足个性化需求，但维护很耗时费力（备份和 CDN）。如果实际生产使用，建议老老实使用提供商的，把同样的钱花在付费续费上，省心不止一点半点。真想弄的话推荐 seafile，内存最好在 2G 以上因为有两个常驻进程非常吃内存。其他的 ownfile、nextfile 等，安全性差不加密存储文件，如果不是为了安全性，谁会自己搭建私有云呢？」

### 大文件临时分享

『可道云 kodexploer』实测资源占用还可以。安全性差不加密存储文件，所以不能作为主力，作为临时分享可以。

### 大文件备份

『百度网盘』人手一个

### 大文件同步

1）『seafile pro 版，内存 2G 以上』（小李飞刀，快速锋利占用内存）

2）~~真心不推荐『nextcloud』（瑞士军刀，全面多样却笨重）和『owncloud』，安全性差不加密存储文件~~

3）家里放台服务器，然后用 Synthing 之类的开共享就可以了，不用瞎折腾

### 小文件同步（10G）

『坚果云』

『 icloud』使用 apple 设备较多时



## 三、网页传送

### 1】h5ai 文件目录

> 用来用去，我还是直接选择了h5ai，简单直接轻便，但不合适存私密文件

一款功能强大php 文件目录列表程序

### 2】Caddy FileBrowser

比 h5ai 还更简单轻便。

缺点：好像只有网页版的；不支持上传文件夹；



## 四、Sync 同步

## 1】Syncthing

> 受到众多高手们的推荐，被誉为是 Resilio Sync / BT Sync 和 Dropbox 的最佳开源替代品
>
> 相较于 Seafile、NextCloud 等服务器工具，Syncthing 实际上更像是一款**文件/文件夹同步工具**

跨多平台（ios 只有简陋版的 fsync）；支持中文界面；文件版本控制（版本数量自己设置）；绿色免安装；



### 同步权限问题 permission denied

测试发现：

* docker 版本，共享 root 文件夹时 permission denied
* ubuntu 安装版，使用普通用户共享 root 文件夹时 permission denied

所以，建议使用 ubuntu 安装板，如果要共享 root 文件夹的就用 root 用户（虽然页面上经常提示要用普通用户）

### 安装

1）ubuntu/debian 安装：

```
# Add the release PGP keys:
curl -s https://syncthing.net/release-key.txt | sudo apt-key add -

# Add the "stable" channel to your APT sources:
echo "deb https://apt.syncthing.net/ syncthing stable" | sudo tee /etc/apt/sources.list.d/syncthing.list

# Update and install syncthing:
sudo apt-get update
sudo apt-get install syncthing
```

 2）修改 gui 的 ip 为 `0.0.0.0:8384`

```
vi ~/.config/syncthing/config.xml
```

3）启动，然后访问网页 `your_ip:8384`，设置图形界面用户名、密码。如果网页打不开，则需要配置防火墙，开放 8384、22000、21027 端口。

```
syncthing
```

4）设置开机启动（假设是 root 用户）

```
cp /lib/systemd/system/syncthing@.service /etc/systemd/system/syncthing@root.service
systemctl restart syncthing@$root.service
systemctl status syncthing@$root.services
systemctl enable syncthing@$root.service
systemctl list-unit-files |grep syncthing
```

端口 22000 监听端口

端口 21027 监听 xx

端口 8384 监听 web 网页

因为默认使用全球发现服务器，受网速影响，还是要等等的。

图形界面 GUI 监听地址

协议监听地址

监听地址，默认 `127.0.0.1:8384`，



发现服务器

### 2】SyncTrayzor

### 3】BT Sync (Resilio Sync)



## 五、共享文件夹

### 1】AFP 共享（mac）

Apple 文件协议(*AFP*) 

### 2】Samba 共享（mac）

*Samba是*在Linux和UNIX系统上实现SMB协议的一个免费软件，由服务器及客户端程序构成。



## 六、本地

家里放台服务器，然后用 Synthing 之类的开共享就可以了，不用瞎折腾